---
layout: post
title: Flickering on Windows
date: '2016-05-24T09:59:00.001-07:00'
author: smelC
tags: 
modified_time: '2016-05-24T10:00:09.624-07:00'
blogger_id: tag:blogger.com,1999:blog-989893979829990763.post-2456041673342245841
blogger_orig_url: https://hgamesdev.blogspot.com/2016/05/flickering-in-windows.html
---

<p>Last week, I corrected a nasty bug in the desktop Windows version of <a href="http://www.schplaf.org/hgames/">Dungeon Mercenary</a> which was reported to me by <a href="https://www.reddit.com/r/brogueforum/comments/4jw8lt/four_months_of_brogueinspired_roguelike_dungeon/">brogue players</a>. The screen was flickering in every part of the game, from the <a href="https://twitter.com/hgamesdev/status/730063116155932673">startup menu</a>, to the <a href="https://twitter.com/hgamesdev/status/730063116155932673">credits screen</a> and the <a href="https://twitter.com/hgamesdev/status/732852509128163328">main game screen</a>. I was like O_o when I discovered that. It meant most of the downloaders of the .jar file were witnessing an unplayable game. What a shame!</p> <p>That was really my fault, because I’m a Linux guy. I work under Linux, I develop Dungeon Mercenary under Linux and never use Windows, except on my chérie’s computer. So I never tried Dungeon Mercenary on Windows before, trusting that <a href="https://github.com/libgdx/">libgdx</a> was doing good in having the same rendering on all platforms. I quickly found the problem after setting up a Windows dev environment: the screen was flickering when the game was <strong>not</strong> drawing. By that I mean that the <code>render(float)</code> method of my <code>ApplicationAdapter</code> was returning early, because it knew there was nothing new to draw. The point of this early-returning business is to save your precious battery’s life. I found the problem quickly, because when the game was <a href="https://www.youtube.com/watch?v=X7Mca61po3w">continuously rendering water</a>, everything was fine.</p> <p>When flickering, the opengl surface was somehow “remembering” old state. I knew I wasn’t doing something wrong, because in-game, the flickering was alternatively showing the startup menu and the game. But the startup menu is disposed in an unrecoverable way when showing the game. So it couldn’t be a bug like “the startup screen is somehow still there, below layers, or offscreen”. Somehow the opengl surface was showing its (own) old internal state. By asking on libgdx’s IRC channel, I discovered that my lazy rendering business was anticipated in libgdx, where it is called <em><a href="https://github.com/libgdx/libgdx/wiki/Continuous-%26-non-continuous-rendering">non continuous rendering</a></em>. There’s a global flag to control that, to avoid libgdx to call <code>render(float)</code> until you request it with <code>Gdx.graphics.requestRendering()</code>. So I thought “let’s use that and I’ll be done”.</p> <p>But that wasn’t the end of the story. For some (unknown) reason, Windows doesn’t like rendering that affects a part of the screen. In Dungeon Mercenary, I was rendering independently the top panel (where information is written), the map (at the center), and the status panel (health bars)(at the bottom). This doesn’t work on Windows, the screen flickers as soon as I do a partial update. So I threw all that fine-grained rendering business away, and redraws the screen entirely, even when I need only to do a part of it. This doesn’t cause much harm, because the real performance gain comes from non-continuous rendering. So Dungeon Mercenary is still saving your battery’s life, and works like a charm under Windows! Go check it out: <a href="http://www.schplaf.org/hgames/">http://www.schplaf.org/hgames/</a></p> <blockquote>  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p></blockquote>