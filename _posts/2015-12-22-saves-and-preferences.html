---
layout: post
title: Saves and Preferences
date: '2015-12-22T03:29:00.001-08:00'
author: smelC
tags: 
modified_time: '2015-12-22T03:30:23.412-08:00'
blogger_id: tag:blogger.com,1999:blog-989893979829990763.post-7659715668205620343
blogger_orig_url: https://hgamesdev.blogspot.com/2015/12/saves-and-preferences.html
---

<p>I implemented saves. It was quick, because I used Java’s <a href="https://docs.oracle.com/javase/7/docs/api/java/io/Serializable.html">Serialization</a> and there was no surprise since I’ve done a lot of tricky serialization business at work. It was also made easier by the fact that I only need to save the current level, since the player looses his way when going to a depth he visited already.</p> <p>My saves are roughly 100Ko which is quite fat, given that I just save the current level’s grid, the monsters, the players, and the scheduler; but I did not bother trying to optimize. I think I do not save too much stuff, since things that can be recomputed (static lighting of torches, FOV of players) are transient. Maybe the weight just comes from the fact that levels have 60*30 cells, and each walkable cell may contain an <code>HashSet</code> (holding the teams that know this cell, this is used to compute the fog of war). Each cell contains a different set, because I did not bother sharing, despite that there are typically only 4 possible sets: ∅, { monsters’ team }, { player’s team }, and { monsters’ team, player’s team} (but this assumption becomes wrong if I add more teams (monsters VS monsters), which is fully supported).</p> <p>I  KISSed the way the game treats saves: I do not handle more than one save at a time. This means you can’t choose the save file’s name. This is handy for the GUI. When there’s no save, the welcome screen is:</p> <p><img src="http://i.imgur.com/rlI9zqJ.png" alt="Welcome screen without any save" title=""></p> <p>When there’s a save, the welcome screen is:</p> <p><img src="http://i.imgur.com/MZ39Iyc.png" alt="Welcome screen with save" title=""></p> <p>As usual in roguelikes, the save is destroyed when you press “continue” and created when you “quit and save”. For the moment, I do not destroy the save when alt-f4ing the game, as it is handy for me to test (play a game until the interesting point, quit; et voila I have a save ready to test the interesting point).</p> <p>On desktop the save is put in ~/.hgames/ama/save0 and on android in the application-private area. To do that I discovered the way <a href="https://github.com/libgdx/libgdx/wiki/File-handling">libgdx abstracts files</a> whose API is very nice.</p> <p>Finally, I handled failure of save loading, as it’ll happen when upgrading from a version to another. In this case, the <em>Continue</em> screen switches to the <em>New Game</em> instead of actually launching the game. This doesn’t give an explanation, but it allows to launch a new game; instead of keeping the player stuck..</p> <p>I also save the user’s preferences. For the moment it only contains the user’s offset w.r.t to the default font size I compute. This is what makes <em>And my Axe!</em> remember your zooming level from sessions to sessions. For that I write a Java <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Properties.html">Property</a> in XML (using the <code>storeToXML</code> method) to disk. libgdx has <a href="https://github.com/libgdx/libgdx/wiki/Preferences">support for preferences</a>, but it is too specialized for me, as it chooses the saving location on its own, in directory <code>.prefs</code> in the user’s directory (on desktop). But I wanted the preferences to be close to the save (i.e. in <code>~/.hgames/ama/</code>) so I did it myself.</p> <blockquote>  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p></blockquote>