---
layout: post
title: Exporting my libgdx game to a Windows executable
date: '2016-06-07T23:57:00.001-07:00'
author: smelC
tags: 
modified_time: '2016-06-07T23:59:29.441-07:00'
blogger_id: tag:blogger.com,1999:blog-989893979829990763.post-6284452942527439206
blogger_orig_url: https://hgamesdev.blogspot.com/2016/06/exporting-my-libgdx-game-to-windows.html
---

<p>Almost two weeks ago, I released <a href="http://www.schplaf.org/hgames">Dungeon Mercenary</a> on <a href="http://gamejolt.com/games/dungeon-mercenary/151692">gamejolt.com</a>. It was quite successful: in a week I <a href="https://twitter.com/hgamesdev/status/738651325043462144">had more hits</a> than in 4 months on <a href="https://hgames.itch.io/dungeon-mercenary">itch.io</a>. So I thought, hey let’s try to give the best of Dungeon Mercenary’s to GameJolt’s players. For that, I wanted to plug with <a href="https://gamejolt.com/api/doc/game">GameJolt’s API</a>. This API is nice: in particular, it offers custom scoreboards and achievements. So I looked for a Java implementation of this API and found that the best one is <a href="https://github.com/ashleygwinnell/Game-Jolt-Java-Game-API">@ashleygwinnell </a>’s one. It isn’t perfect for me, as it doesn’t rely on libgdx and isn’t very GWT-friendly (it uses the jdk’s .net API as well as streams+json+xml) but I can workaround that (use libgdx’s <code>Net</code> API and remove the use of streams+json+xml as GameJolt provides a raw-text API).</p> <p>To use GameJolt’s API, I need to have the player’s username and its token (a credential). It revealed to be the crux of the problem for my Java-based game. GameJolt’s client doesn’t interface with standalone jars which I ship. It interfaces well with Unity-based games, with .exe executables, and a bunch of other formats; but not with Java-games. So my only possibility is to build a .exe (Windows-only obviously, but that’s the majority of players). So I looked up <a href="https://github.com/libgdx/packr/">packr</a>, a tool contributed by the libgdx community, that builds a .exe out of a standalone jar, shipping a Java Runtime Environment with it. I had to face quite a number of errors to get the .exe working, but it ultimately worked and I’ll share this story; in the hope that others benefit of my mistakes.</p> <p>So here’s how it went:</p> <ul><li>At first, I did not understand well what packr was generating. I thought the .exe was standalone. But that’s not the case: the whole “output directory” of packr must be shipped. I was hitting an error about a packr-introduced <code>config.json</code> file that was missing. Indeed, this file is in packr’s output directory, so you need to ship it with the .exe. Problem #1 solved.</li><li>Then, I followed packr’s documentation and tried doing a build using openjdk builds coming <a href="https://github.com/alexkasko/openjdk-unofficial-builds">from this page</a>. It appears that these builds do not work anymore. You better take <a href="http://zulu.org/download/">zulu builds</a>. I don’t remember the error message exactly (it involved some <a href="https://github.com/libgdx/packr/issues/49">error code [126]</a> I believe), but launching the .exe was complaining about <code>ojdkbuild_zlib.dll</code> missing (Google take that, that’s the only hit I know). Problem #2 solved.</li><li><p>Then, it was failing with the following error (note the <code>-c --console -v</code> parameter to my.exe to get output):</p> <p><img src="http://i.imgur.com/LDWTKB4.png" alt="crash #1" title=""></p> <p>The problem was that I was putting libgdx’s jars into Dungeon Mercenary’s jars, <em>without unpacking them</em>. That’s one of the way in which Eclipse compiles a standalone jar. For that it provides a <em>jar-in-jar-loader.zip</em> helper that handles loading of nested jars. This doesn’t seem to work with packr-generated executables. So instead, I unzip libgdx’s jars into Dungeon Mercenary’s jar, to avoid nesting. Problem #3 solved. This was also <a href="https://github.com/libgdx/packr/issues/33">reported on packr’s tracker</a> btw.</p></li><li><p>Then, it was failing with the following error:</p> <p><img src="http://i.imgur.com/p9NhCUm.png" alt="crash #2" title=""></p> <p>The JVM was crashing (<code>Destroyed Java VM</code>) as soon as starting. I suspected that packr’s generated executable wasn’t printing the stacktrace of the exception, because hey, it is okay for a program to exit with an exception. So I added a <code>try ... catch</code> statement around my main. And then I got this report:</p> <p><img src="http://i.imgur.com/3ZdAwfW.png" alt="crash #3" title=""></p> <p>There was an exception when accessing libgdx’s logger at <code>Gdx.app.log</code>. That’s because I log very early on, during the building of my <code>GdxApplicationAdapter</code> and it appears that the packr-generated executable was observing a new initialization state, where libgdx did not set up its logger yet. So I changed my code so that it doesn’t suppose anymore that Gdx.app.log is non-<code>null</code> (defaulting to printing to <code>System.out</code> and <code>System.err</code>in this case). Problem #4 solved.</p></li><li><p>I was ready to face the <a href="https://www.youtube.com/watch?v=9jK-NcRmVcw">final error</a>:</p> <p><img src="http://i.imgur.com/aEWquN0.png" alt="crash #4" title=""></p> <p>For some unknown reason, the packr-generated executable wasn’t finding assets (here the window’s icon) in the <em>assets</em> directory, which is at the root of my main jar. I hereby moved all assets to the jar’s root and I finally got the Windows executable to work. Hurray \o/</p></li></ul> <p>Kudos to libgdx and packr developers for their awesome tools; and people on #libgdx on freenode to help me solve some of those (let me thank Tomski in particular, I did waste some of your time..).</p> <blockquote>  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p></blockquote>