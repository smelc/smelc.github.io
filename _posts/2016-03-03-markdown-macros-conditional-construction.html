---
layout: post
title: Markdown + macros + conditional construction
date: '2016-03-03T04:35:00.001-08:00'
author: smelC
tags: 
modified_time: '2016-03-03T04:35:23.103-08:00'
blogger_id: tag:blogger.com,1999:blog-989893979829990763.post-3273782072195656350
blogger_orig_url: https://hgamesdev.blogspot.com/2016/03/markdown-macros-conditional-construction.html
---

<p>At work, I wrote quite a lot of documentation for our main product. I was in the “committee” to decide which toolchain we would use for that. Given that I was the main documentation-writer at that time, I was roughly the only one to try out the different options we had. At that time, I chose markdown as the language for writing documentation and <a href="pandoc.org">pandoc</a> as the compiler. Since them I became pretty fund of markdown, whose syntax is very nice to write.</p> <p>One thing we wanted at work was conditional inclusion of documents, as well as the possibility of using macros; which looked important to us since we all came from a <a href="https://www.latex-project.org/">LaTeX</a> background. Ultimately though, we did not need it.</p> <p>But since I deploy <a href="http://www.schplaf.org/hgames/">Dungeon Mercenary</a> both on my friend’s server and on <a href="https://hgames.itch.io/dungeon-mercenary">itch.io</a>, I need to generate two slightly different websites. In other words, I need conditional construction of markdown documents! First I tried to use the venerable <a href="http://www.gnu.org/software/m4/m4.html">m4</a> preprocessor. But the syntax was too conflicting with markdown, I had to escape too many things, such as commas. So I tried <a href="http://en.nothingisreal.com/wiki/GPP">gpp</a>, following <a href="https://randomdeterminism.wordpress.com/2012/06/01/how-i-stopped-worring-and-started-using-markdown-like-tex/">this helpful blog entry</a>, which I’ll just rephrase more concisely below.</p> <p>So here’s how to do conditional inclusion with markdown and gpp:</p>   <pre style="" class="prettyprint prettyprinted"><code class="language-markdown"><span class="pln">&lt;#ifdef SCHPLAF&gt;<br />Content written if and only if the macro SCHPLAF evaluates to true.<br />&lt;#endif&gt;</span></code></pre> <p>A macro (here <code>SCHPLAF</code>) being defined on the command line as follows:</p>   <pre style="" class="prettyprint prettyprinted"><code><span class="pln">gpp </span><span class="pun">-</span><span class="pln">DSCHPLAF</span><span class="pun">=</span><span class="kwd">true</span><span class="pln"> </span><span class="pun">-</span><span class="pln">H</span></code></pre> <p>The <code>-H</code> indicates that gpp directives are written using HTML-like syntax.</p> <p>Another need I had (hum, yes baby) was to use macros like in <em>LaTeX</em>, to avoid having to change my files when <a href="http://www.schplaf.org/hgames">Dungeon Mercenary</a>’s version changes (which happens on a weekly basis for now!). So here’s how it goes:</p>   <pre style="" class="prettyprint prettyprinted"><code class="language-markdown"><span class="pln">dm</span><span class="pun">-&lt;#</span><span class="pln">VERSION</span><span class="pun">&gt;.</span><span class="pln">jar</span></code></pre> <p>This outputs <code>dm-16-03-02.jar</code> if <code>VERSION</code> is defined to be <code>16-03-02</code>. Again, it can be defined on the command line as follows:</p>   <pre style="" class="prettyprint prettyprinted"><code><span class="pln">gpp </span><span class="pun">-</span><span class="pln">DVERSION</span><span class="pun">=</span><span class="lit">16</span><span class="pun">-</span><span class="lit">03</span><span class="pun">-</span><span class="lit">02</span></code></pre> <p>Et voilà, you have the combination of markdown’s awesomeness, macros, and conditional construction :-)</p> <blockquote>  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p></blockquote>