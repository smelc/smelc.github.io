---
layout: post
title: Compiling to HTML5
date: '2016-01-13T04:40:00.001-08:00'
author: smelC
tags: 
modified_time: '2016-01-13T04:40:02.587-08:00'
blogger_id: tag:blogger.com,1999:blog-989893979829990763.post-3771024905429551812
blogger_orig_url: https://hgamesdev.blogspot.com/2016/01/compiling-to-html5.html
---

<p>Last week, I started adapting my code to <a href="http://www.gwtproject.org/">GWT</a>, to be able to run the game in a web browser. This is possible because there’s the corresponding backend in <a href="https://libgdx.badlogicgames.com/">libGDX</a>. So once again let me shout that out loud: libGDX is an <em>AWESOME</em> piece of software. I ran into a few issues (detailed below) but nothing blocking.</p> <p>First I had to annotate the parts of <a href="https://github.com/SquidPony/SquidLib">SquidLib</a> that isn’t compatible with GWT with<code>@GwtIncompatible</code>. Fortunately I wasn’t using stuff that was really GWT-incompatible. There were calls to <code>Object.clone()</code> on generic arrays, which is unsupported; so I had to require some callers to pass a preallocated array (in particular in SquidLib’s method <code>T[] Rng.shuffle(T[])</code> that became <code>T[] Rng.shuffle(T[],T[])</code> where the second parameter is the preallocated array (which is returned)). Apart from that, I had to remove SquidLib’s dependency on gson. For that, I precompiled .js files into instances of the appropriate Java objects. For that I coded a <a href="https://github.com/SquidPony/SquidLib/blob/25404eec5dffb5aeecb3fb1add0ddbeffd9bebec/squidlib-util/etc/TilesetsGenerator.java">specific generator</a>, that was useful only once, since the list of .js files to translate is fixed. This removed SquidLib’s <code>DungeonGenerator</code> dependency on both gson and <code>InputStream</code>.</p> <p>After making the code GWT-compliant, I had to get the compiler produces something executable For that I followed Mario Zechner’s <a href="http://www.badlogicgames.com/wordpress/?p=3073">tutorial</a>. There are two modes of compilation: the production one and the “Super Dev” one. At first only the Super Dev one was working, and still, I needed to run the game within a <code>.war</code> file, that is, in a Java-powered server (tomcat). This sounded wrong to me, because I don’t do any server-side call, so I should be able to compile to javascript only. And indeed it is the case. My problem is that I was hitting a firefox bug that made the game crash, as my comment on <a href="https://github.com/libgdx/libgdx/issues/2640#issuecomment-171008207">libgdx bug tracker</a> mentions. It worked like a charm with <a href="https://www.google.fr/chrome/browser/desktop/">Google Chrome</a> once I <a href="http://helpdeskgeek.com/how-to/enable-webgl-support-for-google-chrome-in-linux/">turned WebGL support on</a>.</p> <p>And so, here’s the result:</p> <p><img src="http://i.imgur.com/FEkmh9C.png" alt="And My Axe! in a web browser" title=""></p> <p>I still need to implement the last missing runic and fix a few bugs, and I’ll be on tracks to publish the first version!</p> <blockquote>  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p></blockquote>